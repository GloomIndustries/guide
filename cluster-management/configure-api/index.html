<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="All you need to know about Screwdriver and more">
        
        <link rel="canonical" href="http://screwdriver.cd/cluster-management/configure-api/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Configuring the API - Screwdriver Guide</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/homepage.css" rel="stylesheet">
        <link href="../../css/navbar.css" rel="stylesheet">
        <link href="../../css/yaml.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-88158708-1', 'docs.screwdriver.cd');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Screwdriver Guide</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/screwdriver-cd/guide">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Cluster Management <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../">Overall Architecture</a>
</li>

                        
                            
<li class="active">
    <a href="./">Configuring the API</a>
</li>

                        
                            
<li >
    <a href="../configure-ui/">Configuring the UI</a>
</li>

                        
                            
<li >
    <a href="../configure-store/">Configuring the Store</a>
</li>

                        
                            
<li >
    <a href="../running-locally/">Running Locally</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Examples</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../kubernetes/">Kubernetes</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../user-guide/quickstart/">Quickstart</a>
</li>

                        
                            
<li >
    <a href="../../user-guide/authentication-authorization/">Authentication and Authorization</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Configuration</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../user-guide/configuration/">Overall</a>
</li>

        
            
<li >
    <a href="../../user-guide/configuration/secrets/">Secrets</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../user-guide/environment-variables/">Environment Variables</a>
</li>

                        
                            
<li >
    <a href="../../user-guide/api/">API</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../about/">What is Screwdriver?</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Appendix</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../about/appendix/domain/">Domain Model</a>
</li>

        
            
<li >
    <a href="../../about/appendix/execution-engines/">Execution Engines</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../about/contributing/">Contributing</a>
</li>

                        
                            
<li >
    <a href="../../about/support/">Support</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            
        </div>
    </div>
</div>
        <div class="container">
            
                
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#managing-the-api">Managing the API</a></li>
        
            <li><a href="#packages">Packages</a></li>
        
            <li><a href="#configuration">Configuration</a></li>
        
            <li><a href="#extending-the-docker-container">Extending the Docker container</a></li>
        
    
    </ul>
</div></div>
                
                <div class="col-md-9" role="main">

<h1 id="managing-the-api">Managing the API</h1>
<h2 id="packages">Packages</h2>
<p>Like the other services, the API is shipped as a <a href="https://hub.docker.com/r/screwdrivercd/screwdriver/">Docker image</a> with port 8080 exposed.</p>
<pre><code class="bash">$ docker run -d -p 9000:8080 screwdrivercd/screwdriver:stable
$ open http://localhost:9000
</code></pre>

<p>Our images are tagged for their version (eg. <code>1.2.3</code>) as well as a floating <code>latest</code> and <code>stable</code>.  Most installations should be using <code>stable</code> or the fixed version tags.</p>
<h2 id="configuration">Configuration</h2>
<p>Screwdriver already <a href="https://github.com/screwdriver-cd/screwdriver/blob/master/config/default.yaml">defaults most configuration</a>, but you can override defaults using a <code>config/local.yaml</code> or environment variables. All the possible environment variables are <a href="https://github.com/screwdriver-cd/screwdriver/blob/master/config/custom-environment-variables.yaml">defined here</a>.</p>
<h3 id="authentication-authorization">Authentication / Authorization</h3>
<p>Configure how users can and who can access the API.</p>
<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Required</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">SECRET_JWT_PRIVATE_KEY</td>
<td align="left">Yes</td>
<td align="left">A private key uses for signing jwt tokens. Generate one by running <code>$ openssl genrsa -out jwt.pem 2048</code></td>
</tr>
<tr>
<td align="left">SECRET_JWT_PUBLIC_KEY</td>
<td align="left">Yes</td>
<td align="left">The public key used for verifying the signature. Generate one by running <code>$ openssl rsa -in jwt.pem -pubout -out jwt.pub</code></td>
</tr>
<tr>
<td align="left">SECRET_ACCESS_KEY</td>
<td align="left">No</td>
<td align="left">The access token to use on behalf of a user to access the API. Used as an alternative to the OAuth flow</td>
</tr>
<tr>
<td align="left">SECRET_ACCESS_USER</td>
<td align="left">No</td>
<td align="left">The user name associated with the temporary access token. Used as a means of functionally testing the API</td>
</tr>
<tr>
<td align="left">SECRET_COOKIE_PASSWORD</td>
<td align="left">Yes</td>
<td align="left">A password used for encrypting session data. <strong>Needs to be minimum 32 characters</strong></td>
</tr>
<tr>
<td align="left">SECRET_PASSWORD</td>
<td align="left">Yes</td>
<td align="left">A password used for encrypting stored secrets. <strong>Needs to be minimum 32 characters</strong></td>
</tr>
<tr>
<td align="left">IS_HTTPS</td>
<td align="left">No</td>
<td align="left">A flag to set if the server is running over https. Used as a flag for the OAuth flow (default to <code>false</code>)</td>
</tr>
<tr>
<td align="left">SECRET_WHITELIST</td>
<td align="left">No</td>
<td align="left">Whitelist of users able to authenticate against the system. If empty, it allows everyone. (JSON Array format)</td>
</tr>
<tr>
<td align="left">SECRET_ADMINS</td>
<td align="left">No</td>
<td align="left">Whitelist of users able to authenticate against the system. If empty, it allows everyone. (JSON Array format)</td>
</tr>
</tbody>
</table>
<pre><code class="yaml"># config/local.yaml
auth:
    jwtPrivateKey: |
        PRIVATE KEY HERE
    jwtPublicKey: |
        PUBLIC KEY HERE
    temporaryAccessKey: 2e422dca8345df03d8f6c306349cbdada30175a4
    temporaryAccessUser: robin
    cookiePassword: 975452d6554228b581bf34197bcb4e0a08622e24
    encryptionPassword: 5c6d9edc3a951cda763f650235cfc41a3fc23fe8
    https: false
    whitelist:
        - batman
        - robin
    admins:
        - batman
</code></pre>

<h3 id="bookend-plugins">Bookend Plugins</h3>
<p>You can globally configure which built-in bookend plugins will be used during a build. By default, <code>scm</code> is enabled to begin builds with a SCM checkout command.</p>
<p>If you're looking to include a custom bookend in the API, please refer <a href="#extending-the-docker-container">here</a>.</p>
<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">BOOKENDS_SETUP</td>
<td align="left">None</td>
<td align="left">The ordered list of plugins to execute at the beginning of every build. Take the forms of <code>'["first", "second", ...]'</code></td>
</tr>
<tr>
<td align="left">BOOKENDS_TEARDOWN</td>
<td align="left">None</td>
<td align="left">The ordered list of plugins to execute at the end of every build. Take the forms of <code>'["first", "second", ...]'</code></td>
</tr>
</tbody>
</table>
<pre><code class="yaml"># config/local.yaml
bookends:
    setup:
        - scm
        - my-custom-bookend
</code></pre>

<h3 id="serving">Serving</h3>
<p>Configure the how the service is listening for traffic.</p>
<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">PORT</td>
<td align="left">80</td>
<td align="left">Port to listen on</td>
</tr>
<tr>
<td align="left">HOST</td>
<td align="left">0.0.0.0</td>
<td align="left">Host to listen on (set to localhost to only accept connections from this machine)</td>
</tr>
<tr>
<td align="left">URI</td>
<td align="left">http://localhost:80</td>
<td align="left">Externally routable URI (usually your load balancer or CNAME)</td>
</tr>
<tr>
<td align="left">HTTPD_TLS</td>
<td align="left">false</td>
<td align="left">SSL support; for SSL, replace <code>false</code> with a JSON object that provides the options required by <a href="https://nodejs.org/api/tls.html#tls_tls_createserver_options_secureconnectionlistener"><code>tls.createServer</code></a></td>
</tr>
</tbody>
</table>
<pre><code class="yaml"># config/local.yaml
httpd:
    port: 443
    host: 0.0.0.0
    uri: https://localhost
    tls:
        key: |
            PRIVATE KEY HERE
        cert: |
            YOUR CERT HERE
</code></pre>

<h3 id="ecosystem">Ecosystem</h3>
<p>Specify externally routable URLs for your UI, Artifact Store, and Badge service.</p>
<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">ECOSYSTEM_UI</td>
<td align="left">https://cd.screwdriver.cd</td>
<td align="left">URL for the User Interface</td>
</tr>
<tr>
<td align="left">ECOSYSTEM_STORE</td>
<td align="left">https://store.screwdriver.cd</td>
<td align="left">URL for the Artifact Store</td>
</tr>
<tr>
<td align="left">ECOSYSTEM_BADGES</td>
<td align="left">https://img.shields.io/badge/build-{{status}}-{{color}}.svg</td>
<td align="left">URL with templates for status text and color</td>
</tr>
</tbody>
</table>
<pre><code class="yaml"># config/local.yaml
ecosystem:
    # Externally routable URL for the User Interface
    ui: https://cd.screwdriver.cd
    # Externally routable URL for the Artifact Store
    store: https://store.screwdriver.cd
    # Badge service (needs to add a status and color)
    badges: https://img.shields.io/badge/build-{{status}}-{{color}}.svg
</code></pre>

<h3 id="datastore-plugin">Datastore Plugin</h3>
<p>To use Postgres, MySQL, and Sqlite, use <a href="https://github.com/screwdriver-cd/datastore-sequelize">sequelize</a> plugin.</p>
<h4 id="sequelize">Sequelize</h4>
<p>Set these environment variables:</p>
<table>
<thead>
<tr>
<th align="left">Environment name</th>
<th align="left">Required</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">DATASTORE_PLUGIN</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">Set to <code>sequelize</code></td>
</tr>
<tr>
<td align="left">DATASTORE_SEQUELIZE_DIALECT</td>
<td align="left">No</td>
<td align="left">mysql</td>
<td align="left">Can be <code>sqlite</code>, <code>postgres</code>, <code>mysql</code>, or <code>mssql</code></td>
</tr>
<tr>
<td align="left">DATASTORE_SEQUELIZE_DATABASE</td>
<td align="left">No</td>
<td align="left">screwdriver</td>
<td align="left">Database name</td>
</tr>
<tr>
<td align="left">DATASTORE_SEQUELIZE_USERNAME</td>
<td align="left">No for sqlite</td>
<td align="left"></td>
<td align="left">Login username</td>
</tr>
<tr>
<td align="left">DATASTORE_SEQUELIZE_PASSWORD</td>
<td align="left">No for sqlite</td>
<td align="left"></td>
<td align="left">Login password</td>
</tr>
<tr>
<td align="left">DATASTORE_SEQUELIZE_STORAGE</td>
<td align="left">Yes for sqlite</td>
<td align="left"></td>
<td align="left">Storage location for sqlite</td>
</tr>
<tr>
<td align="left">DATASTORE_SEQUELIZE_HOST</td>
<td align="left">No</td>
<td align="left"></td>
<td align="left">Network host</td>
</tr>
<tr>
<td align="left">DATASTORE_SEQUELIZE_PORT</td>
<td align="left">No</td>
<td align="left"></td>
<td align="left">Network port</td>
</tr>
</tbody>
</table>
<pre><code class="yaml"># config/local.yaml
datastore:
    plugin: sequelize
    sequelize:
        dialect: TYPE-OF-SERVER
        storage: STORAGE-LOCATION
        database: DATABASE-NAME
        username: DATABASE-USERNAME
        password: DATABASE-PASSWORD
        host: NETWORK-HOST
        port: NETWORK-PORT
</code></pre>

<h3 id="executor-plugin">Executor Plugin</h3>
<p>We currently support <a href="https://github.com/screwdriver-cd/executor-k8s">kubernetes</a> and <a href="http://github.com/screwdriver-cd/executor-docker">docker</a> executor</p>
<h4 id="kubernetes">Kubernetes</h4>
<p>Set these environment variables:</p>
<table>
<thead>
<tr>
<th align="left">Environment name</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">EXECUTOR_PLUGIN</td>
<td align="left"></td>
<td align="left">Set to <code>k8s</code></td>
</tr>
<tr>
<td align="left">LAUNCH_VERSION</td>
<td align="left"></td>
<td align="left">Launcher version to use</td>
</tr>
<tr>
<td align="left">K8S_HOST</td>
<td align="left"></td>
<td align="left">Kubernetes host</td>
</tr>
<tr>
<td align="left">K8S_TOKEN</td>
<td align="left"></td>
<td align="left">JWT for authenticating Kubernetes requests</td>
</tr>
<tr>
<td align="left">K8S_JOBS_NAMESPACE</td>
<td align="left">default</td>
<td align="left">Jobs namespace for Kubernetes jobs URL</td>
</tr>
</tbody>
</table>
<pre><code class="yaml"># config/local.yaml
executor:
    plugin: k8s
    k8s:
        kubernetes:
            # The host or IP of the kubernetes cluster
            host: YOUR-KUBERNETES-HOST
            token: JWT-FOR-AUTHENTICATING-KUBERNETES-REQUEST
            jobsNamespace: default
        launchVersion: stable
</code></pre>

<h4 id="docker">Docker</h4>
<p>Or set these environment variables:</p>
<table>
<thead>
<tr>
<th align="left">Environment name</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">EXECUTOR_PLUGIN</td>
<td align="left">docker</td>
<td align="left">Set to <code>docker</code></td>
</tr>
<tr>
<td align="left">LAUNCH_VERSION</td>
<td align="left">stable</td>
<td align="left">Launcher version to use</td>
</tr>
<tr>
<td align="left">EXECUTOR_DOCKER_DOCKER</td>
<td align="left"><code>{}</code></td>
<td align="left"><a href="https://www.npmjs.com/package/dockerode#getting-started">Dockerode configuration</a> (JSON object)</td>
</tr>
</tbody>
</table>
<pre><code class="yaml"># config/local.yaml
executor:
    plugin: docker
    docker:
        docker:
            socketPath: /var/lib/docker.sock
        launchVersion: stable
</code></pre>

<h3 id="email-notifications">Email Notifications</h3>
<p>Configure the SMTP server and sender address that email notifications will be sent from.</p>
<pre><code class="yaml"># config/local.yaml
notifications:
    email:
        host: smtp.yourhost.com
        port: 25
        from: example@email.com
</code></pre>

<p>Configurable authentication settings have not yet been built, but can easily be added. We’re using the <a href="https://nodemailer.com/about/">nodemailer</a> package to power emails, so authentication features will be similar to any typical nodemailer setup. Contribute at: <a href="https://github.com/screwdriver-cd/notifications-email">https://github.com/screwdriver-cd/notifications-email</a></p>
<h3 id="source-control-plugin">Source Control Plugin</h3>
<p>We currently support <a href="https://github.com/screwdriver-cd/scm-github">Github</a> and <a href="https://github.com/screwdriver-cd/scm-bitbucket">Bitbucket.org</a></p>
<h4 id="step-1-set-up-your-oauth-application">Step 1: Set up your OAuth Application</h4>
<p>You will need to set up an OAuth Application and retrieve your OAuth Client ID and Secret.</p>
<h5 id="github">Github:</h5>
<ol>
<li>Navigate to the <a href="https://github.com/settings/developers">Github OAuth applications</a> page.</li>
<li>Click on the application you created to get your OAuth Client ID and Secret.</li>
<li>Fill out the <code>Homepage URL</code> and <code>Authorization callback URL</code> to be the IP address of where your API is running.</li>
</ol>
<h5 id="bitbucketorg">Bitbucket.org:</h5>
<ol>
<li>Navigate to the Bitbucket OAuth applications: <a href="https://bitbucket.org/account/user/{your-username}/api">https://bitbucket.org/account/user/{your-username}/api</a></li>
<li>Click on <code>Add Consumer</code>.</li>
<li>Fill out the <code>URL</code> and <code>Callback URL</code> to be the IP address of where your API is running.</li>
</ol>
<h4 id="step-2-configure-your-scm-plugin">Step 2: Configure your SCM plugin</h4>
<p>Set these environment variables:</p>
<table>
<thead>
<tr>
<th align="left">Environment name</th>
<th align="left">Required</th>
<th align="left">Default Value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">SCM_PLUGIN</td>
<td align="left">No</td>
<td align="left">github</td>
<td align="left"><code>github</code> or <code>bitbucket</code></td>
</tr>
<tr>
<td align="left">SECRET_OAUTH_CLIENT_ID</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">Your OAuth Client Id (Application key)</td>
</tr>
<tr>
<td align="left">SECRET_OAUTH_CLIENT_SECRET</td>
<td align="left">Yes</td>
<td align="left"></td>
<td align="left">You OAuth Client secret (Application secret)</td>
</tr>
<tr>
<td align="left">WEBHOOK_GITHUB_SECRET</td>
<td align="left">Yes for Github</td>
<td align="left"></td>
<td align="left">Secret to sign for webhooks</td>
</tr>
<tr>
<td align="left">SCM_GITHUB_GHE_HOST</td>
<td align="left">Yes for Github Enterprise</td>
<td align="left"></td>
<td align="left">GHE host for Github Enterprise</td>
</tr>
<tr>
<td align="left">SCM_PRIVATE_REPO_SUPPORT</td>
<td align="left">No</td>
<td align="left">false</td>
<td align="left">Ask Github users for 'repo' scope to allow read/write access to public and private repo</td>
</tr>
<tr>
<td align="left">SCM_USERNAME</td>
<td align="left">No</td>
<td align="left">sd-buildbot</td>
<td align="left">Username for checkout</td>
</tr>
<tr>
<td align="left">SCM_EMAIL</td>
<td align="left">No</td>
<td align="left">dev-null@screwdriver.cd</td>
<td align="left">Email of user for checkout</td>
</tr>
</tbody>
</table>
<h5 id="github_1">Github:</h5>
<pre><code class="yaml"># config/local.yaml
scm:
    plugin: github
    github:
        oauthClientId: YOUR-OAUTH-CLIENT-ID
        oauthClientSecret: YOUR-OAUTH-CLIENT-SECRET
        # Secret to add to GitHub webhooks so that we can validate them
        secret: SUPER-SECRET-SIGNING-THING
        # You can also configure for use with GitHub enterprise
        # gheHost: github.screwdriver.cd
        # Whether to support private repo
        # privateRepo: true
</code></pre>

<p>If users want to use private repo, they also need to set up <code>SCM_USERNAME</code> and <code>SCM_ACCESS_TOKEN</code> as <a href="../../user-guide/configuration/secrets/">secrets</a> in their <code>screwdriver.yaml</code>.</p>
<h5 id="bitbucketorg_1">Bitbucket.org</h5>
<pre><code class="yaml"># config/local.yaml
scm:
    plugin: bitbucket
    bitbucket:
        oauthClientId: YOUR-APP-KEY
        oauthClientSecret: YOUR-APP-SECRET
</code></pre>

<h2 id="extending-the-docker-container">Extending the Docker container</h2>
<p>There are some scenarios where you would prefer to extend the Screwdriver.cd Docker image, such as using custom Bookend plugins. This section is not meant to be exhaustive or complete, but will provide insight into some of the fundamental cases.</p>
<h3 id="using-a-custom-bookend">Using a custom bookend</h3>
<p>Using a custom bookend is a common case where you would extend the Screwdriver.cd Docker image.</p>
<p>In this chosen example, we want to have our bookend execute before the <code>scm</code> (which checks out the code from the configured SCM). Although the bookend plugins can be configured by environment variables, we will show how to accomplish the same task with a <code>local.yaml</code> file.</p>
<p>This is shown in the following <code>local.yaml</code> snippet:</p>
<pre><code class="yaml"># local.yaml
---
  ...
bookends:
  setup:
    - my-custom-bookend
    - scm
</code></pre>

<p>For building our extended Docker image, we will need to create a <code>Dockerfile</code> that will have our extra dependencies installed. If you would prefer to save the <code>local.yaml</code> configuration file in the Docker image instead of mounting it in later, you may do so in the Dockerfile as well.</p>
<pre><code class="dockerfile"># Dockerfile
FROM screwdrivercd/screwdriver:stable

# Install additional NPM bookend plugin
RUN cd /usr/src/app &amp;&amp; /usr/local/bin/npm install my-custom-bookend

# Optionally save the configuration file in the image
ADD local.yaml /config/local.yaml
</code></pre>

<p>Once you build the Docker image, you will need to deploy it to your Screwdriver.cd cluster. For instance, if you're using Kubernetes, you would replace the <code>screwdrivercd/api:stable</code> image to your custom Docker image.</p>
<p>The following is an example snippet of an updated Kubernetes deployment configuration:</p>
<pre><code class="yaml"># partial Kubernetes configuration
  ...
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: screwdriver-api
        # The image name is the one you specified when built
        # The tag name is the tag you specified when built
        image: my_extended_docker_image_name:tag_name
</code></pre></div>
            
        </div>

        <footer>
            <div class="container">
                <div class="col-xs-6">
                    <p>All code on this site is licensed under the <a href="https://github.com/screwdriver-cd/screwdriver/blob/master/LICENSE">Yahoo BSD License</a> unless otherwise stated.</p>
                </div>
                <div class="col-xs-6">
                    
                        <p>© 2016 Yahoo! Inc. All rights reserved.</p>
                    
                </div>
            </div>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../js/vendor/jquery-3.1.0.min.js"></script>
        <script src="../../js/yaml.js"></script>
        <script src="../../js/i18n.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
